# Generated by Django 5.2.5 on 2026-01-02 17:18

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('finance', '0001_initial'),
        ('schools', '0010_alter_gasoilrecord_id_alter_vehicle_driver'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='BudgetCategory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('name_arabic', models.CharField(blank=True, max_length=100)),
                ('name_french', models.CharField(blank=True, max_length=100)),
                ('expense_category', models.CharField(blank=True, choices=[('SALARY', 'Salaries & Wages'), ('BONUS', 'Bonuses & Incentives'), ('BENEFITS', 'Employee Benefits'), ('FUEL', 'Fuel & Gasoil'), ('UTILITIES', 'Utilities (Water, Electricity, Internet)'), ('SUPPLIES', 'Office & Educational Supplies'), ('MAINTENANCE', 'Maintenance & Repairs'), ('TRANSPORTATION', 'Transportation Expenses'), ('RENT', 'Rent & Lease'), ('EQUIPMENT', 'Equipment Purchase'), ('RENOVATION', 'Renovation & Construction'), ('SOFTWARE', 'Software & Licenses'), ('PROFESSIONAL_SERVICES', 'Professional Services'), ('INSURANCE', 'Insurance'), ('TAXES', 'Taxes & Fees'), ('MARKETING', 'Marketing & Advertising'), ('OTHER_EXPENSE', 'Other Expenses')], max_length=30, null=True)),
                ('description', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('order', models.PositiveIntegerField(default=0)),
                ('parent', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='subcategories', to='finance.budgetcategory')),
            ],
            options={
                'verbose_name_plural': 'Budget Categories',
                'ordering': ['order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='EmploymentContract',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contract_type', models.CharField(choices=[('FULL_TIME_MONTHLY', 'Full-Time (Monthly Salary)'), ('PART_TIME_MONTHLY', 'Part-Time (Monthly Salary)'), ('HOURLY', 'Hourly Contract'), ('PER_LESSON', 'Per Lesson/Session'), ('FIXED_TERM', 'Fixed Term Contract'), ('INTERNSHIP', 'Internship/Training')], default='FULL_TIME_MONTHLY', max_length=30)),
                ('contract_number', models.CharField(help_text='Internal contract reference', max_length=50, unique=True)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField(blank=True, help_text='Leave blank for indefinite contracts', null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('base_amount', models.DecimalField(decimal_places=2, help_text='Base salary (monthly) or rate (hourly/per-lesson)', max_digits=10)),
                ('currency', models.CharField(default='MAD', max_length=3)),
                ('hours_per_week', models.DecimalField(blank=True, decimal_places=2, help_text='Expected weekly hours (for hourly contracts)', max_digits=5, null=True)),
                ('lessons_per_week', models.PositiveIntegerField(blank=True, help_text='Expected weekly lessons (for per-lesson contracts)', null=True)),
                ('transportation_allowance', models.DecimalField(decimal_places=2, default=0, help_text='Monthly transportation allowance', max_digits=10)),
                ('housing_allowance', models.DecimalField(decimal_places=2, default=0, help_text='Monthly housing allowance', max_digits=10)),
                ('other_allowances', models.DecimalField(decimal_places=2, default=0, help_text='Other monthly allowances', max_digits=10)),
                ('social_security_rate', models.DecimalField(decimal_places=2, default=0, help_text='Social security deduction percentage', max_digits=5)),
                ('tax_exemption_amount', models.DecimalField(decimal_places=2, default=0, help_text='Amount exempt from income tax', max_digits=10)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_contracts', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(limit_choices_to={'role__in': ['TEACHER', 'STAFF', 'DRIVER']}, on_delete=django.db.models.deletion.CASCADE, related_name='employment_contracts', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-start_date', 'employee__last_name'],
            },
        ),
        migrations.CreateModel(
            name='ExpenseRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('category', models.CharField(choices=[('SALARY', 'Salaries & Wages'), ('BONUS', 'Bonuses & Incentives'), ('BENEFITS', 'Employee Benefits'), ('FUEL', 'Fuel & Gasoil'), ('UTILITIES', 'Utilities (Water, Electricity, Internet)'), ('SUPPLIES', 'Office & Educational Supplies'), ('MAINTENANCE', 'Maintenance & Repairs'), ('TRANSPORTATION', 'Transportation Expenses'), ('RENT', 'Rent & Lease'), ('EQUIPMENT', 'Equipment Purchase'), ('RENOVATION', 'Renovation & Construction'), ('SOFTWARE', 'Software & Licenses'), ('PROFESSIONAL_SERVICES', 'Professional Services'), ('INSURANCE', 'Insurance'), ('TAXES', 'Taxes & Fees'), ('MARKETING', 'Marketing & Advertising'), ('OTHER_EXPENSE', 'Other Expenses')], max_length=30)),
                ('subcategory', models.CharField(blank=True, help_text='Custom subcategory for detailed tracking', max_length=100)),
                ('title', models.CharField(max_length=200)),
                ('description', models.TextField()),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('expense_date', models.DateField()),
                ('vendor_name', models.CharField(blank=True, max_length=200)),
                ('vendor_contact', models.CharField(blank=True, max_length=100)),
                ('invoice_number', models.CharField(blank=True, max_length=100)),
                ('payment_status', models.CharField(choices=[('PENDING', 'Pending'), ('PARTIAL', 'Partially Paid'), ('PAID', 'Paid'), ('OVERDUE', 'Overdue')], default='PENDING', max_length=20)),
                ('paid_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('payment_method', models.CharField(blank=True, choices=[('CASH', 'Cash'), ('CHECK', 'Check'), ('TRANSFER', 'Bank Transfer'), ('OTHER', 'Other')], max_length=20, null=True)),
                ('due_date', models.DateField(blank=True, null=True)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('SUBMITTED', 'Submitted'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected'), ('COMPLETED', 'Completed')], default='DRAFT', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('academic_year', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='expense_records', to='schools.academicyear')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_expenses', to=settings.AUTH_USER_MODEL)),
                ('budget_category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='expense_records', to='finance.budgetcategory')),
                ('requested_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='requested_expenses', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-expense_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PayrollEntry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('base_salary', models.DecimalField(decimal_places=2, max_digits=10)),
                ('transportation_allowance', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('housing_allowance', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('other_allowances', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('overtime_pay', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('bonus', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('hours_worked', models.DecimalField(blank=True, decimal_places=2, help_text='Actual hours worked (for hourly contracts)', max_digits=6, null=True)),
                ('lessons_taught', models.PositiveIntegerField(blank=True, help_text='Actual lessons taught (for per-lesson contracts)', null=True)),
                ('gross_salary', models.DecimalField(decimal_places=2, max_digits=10)),
                ('social_security', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('income_tax', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('advance_payment', models.DecimalField(decimal_places=2, default=0, help_text='Salary advances to deduct', max_digits=10)),
                ('loan_deduction', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('other_deductions', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('total_deductions', models.DecimalField(decimal_places=2, max_digits=10)),
                ('net_salary', models.DecimalField(decimal_places=2, max_digits=10)),
                ('is_paid', models.BooleanField(default=False)),
                ('payment_date', models.DateField(blank=True, null=True)),
                ('payment_method', models.CharField(choices=[('CASH', 'Cash'), ('CHECK', 'Check'), ('TRANSFER', 'Bank Transfer'), ('OTHER', 'Other')], default='TRANSFER', max_length=20)),
                ('payment_reference', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payroll_entries', to='finance.employmentcontract')),
                ('employee', models.ForeignKey(limit_choices_to={'role__in': ['TEACHER', 'STAFF', 'DRIVER']}, on_delete=django.db.models.deletion.CASCADE, related_name='payroll_entries', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['employee__last_name', 'employee__first_name'],
            },
        ),
        migrations.CreateModel(
            name='FinancialTransaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('transaction_type', models.CharField(choices=[('INCOME', 'Income'), ('EXPENSE', 'Expense')], max_length=10)),
                ('income_category', models.CharField(blank=True, choices=[('STUDENT_FEES', 'Student Tuition & Fees'), ('REGISTRATION', 'Registration Fees'), ('DONATIONS', 'Donations'), ('GRANTS', 'Grants & Subsidies'), ('OTHER_INCOME', 'Other Income')], help_text='Required for income transactions', max_length=30, null=True)),
                ('expense_category', models.CharField(blank=True, choices=[('SALARY', 'Salaries & Wages'), ('BONUS', 'Bonuses & Incentives'), ('BENEFITS', 'Employee Benefits'), ('FUEL', 'Fuel & Gasoil'), ('UTILITIES', 'Utilities (Water, Electricity, Internet)'), ('SUPPLIES', 'Office & Educational Supplies'), ('MAINTENANCE', 'Maintenance & Repairs'), ('TRANSPORTATION', 'Transportation Expenses'), ('RENT', 'Rent & Lease'), ('EQUIPMENT', 'Equipment Purchase'), ('RENOVATION', 'Renovation & Construction'), ('SOFTWARE', 'Software & Licenses'), ('PROFESSIONAL_SERVICES', 'Professional Services'), ('INSURANCE', 'Insurance'), ('TAXES', 'Taxes & Fees'), ('MARKETING', 'Marketing & Advertising'), ('OTHER_EXPENSE', 'Other Expenses')], help_text='Required for expense transactions', max_length=30, null=True)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('currency', models.CharField(default='MAD', max_length=3)),
                ('transaction_date', models.DateField()),
                ('description', models.CharField(max_length=255)),
                ('notes', models.TextField(blank=True)),
                ('payment_method', models.CharField(choices=[('CASH', 'Cash'), ('CHECK', 'Check'), ('TRANSFER', 'Bank Transfer'), ('OTHER', 'Other')], default='CASH', max_length=20)),
                ('reference_number', models.CharField(blank=True, help_text='Check number, transaction ID, etc.', max_length=100)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('COMPLETED', 'Completed'), ('CANCELLED', 'Cancelled')], default='PENDING', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('academic_year', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='financial_transactions', to='schools.academicyear')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_transactions', to=settings.AUTH_USER_MODEL)),
                ('expense_record', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='finance.expenserecord')),
                ('gasoil_record', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='schools.gasoilrecord')),
                ('invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='finance.invoice')),
                ('recorded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='recorded_transactions', to=settings.AUTH_USER_MODEL)),
                ('payroll_entry', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='transactions', to='finance.payrollentry')),
            ],
            options={
                'ordering': ['-transaction_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PayrollPeriod',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('payment_date', models.DateField(help_text='Scheduled payment date')),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PROCESSING', 'Processing'), ('APPROVED', 'Approved'), ('PAID', 'Paid'), ('CLOSED', 'Closed')], default='DRAFT', max_length=20)),
                ('total_gross', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_deductions', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_net', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('employee_count', models.PositiveIntegerField(default=0)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('academic_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payroll_periods', to='schools.academicyear')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_payroll_periods', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_payroll_periods', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-period_start'],
            },
        ),
        migrations.AddField(
            model_name='payrollentry',
            name='payroll_period',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payroll_entries', to='finance.payrollperiod'),
        ),
        migrations.CreateModel(
            name='Budget',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('allocated_amount', models.DecimalField(decimal_places=2, help_text='Total budget allocated for this category', max_digits=12)),
                ('period_start', models.DateField(blank=True, null=True)),
                ('period_end', models.DateField(blank=True, null=True)),
                ('spent_amount', models.DecimalField(decimal_places=2, default=0, help_text='Automatically calculated from expenses', max_digits=12)),
                ('alert_threshold', models.DecimalField(decimal_places=2, default=80.0, help_text='Alert when spending reaches this percentage (0-100)', max_digits=5)),
                ('is_exceeded', models.BooleanField(default=False)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('academic_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='budgets', to='schools.academicyear')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_budgets', to=settings.AUTH_USER_MODEL)),
                ('category', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='budgets', to='finance.budgetcategory')),
            ],
            options={
                'ordering': ['academic_year', 'category'],
                'unique_together': {('academic_year', 'category', 'period_start')},
            },
        ),
        migrations.AddIndex(
            model_name='employmentcontract',
            index=models.Index(fields=['employee', 'is_active'], name='finance_emp_employe_cc069f_idx'),
        ),
        migrations.AddIndex(
            model_name='employmentcontract',
            index=models.Index(fields=['start_date', 'end_date'], name='finance_emp_start_d_b1a91f_idx'),
        ),
        migrations.AddIndex(
            model_name='expenserecord',
            index=models.Index(fields=['category', 'expense_date'], name='finance_exp_categor_d20bc4_idx'),
        ),
        migrations.AddIndex(
            model_name='expenserecord',
            index=models.Index(fields=['academic_year', 'category'], name='finance_exp_academi_3ff001_idx'),
        ),
        migrations.AddIndex(
            model_name='expenserecord',
            index=models.Index(fields=['payment_status', 'due_date'], name='finance_exp_payment_0f5be8_idx'),
        ),
        migrations.AddIndex(
            model_name='financialtransaction',
            index=models.Index(fields=['transaction_type', 'transaction_date'], name='finance_fin_transac_5bf1ec_idx'),
        ),
        migrations.AddIndex(
            model_name='financialtransaction',
            index=models.Index(fields=['academic_year', 'transaction_type'], name='finance_fin_academi_1bcf6e_idx'),
        ),
        migrations.AddIndex(
            model_name='financialtransaction',
            index=models.Index(fields=['expense_category', 'transaction_date'], name='finance_fin_expense_256524_idx'),
        ),
        migrations.AddIndex(
            model_name='financialtransaction',
            index=models.Index(fields=['income_category', 'transaction_date'], name='finance_fin_income__6cec51_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='payrollperiod',
            unique_together={('academic_year', 'period_start', 'period_end')},
        ),
        migrations.AddIndex(
            model_name='payrollentry',
            index=models.Index(fields=['payroll_period', 'employee'], name='finance_pay_payroll_9fc190_idx'),
        ),
        migrations.AddIndex(
            model_name='payrollentry',
            index=models.Index(fields=['is_paid', 'payment_date'], name='finance_pay_is_paid_56b9e6_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='payrollentry',
            unique_together={('payroll_period', 'employee')},
        ),
    ]
